<span style="font-family: verdana, geneva, sans-serif;"><!DOCTYPE html>
  <html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>E-TICKETING | Dashboard</title>
    <link rel="stylesheet" href="style4.css" />
    <!-- Font Awesome Cdn Link -->
    <link rel="stylesheet" href="C:/Users/graci/Desktop/Fontawesome/Font_Awesome_Pro_v6_Alpha_2/fontawesome6/fontawesome6/pro/css/all.min.css"/>
  </head>
  <body>
    <div class="container">
      <!-- Navigation bar-->
      <nav>
        <ul>
          <li><a href="#" class="logo">
            <img src="./image/logo.jpg">
            <span class="nav-item">Admin</span>
          </a></li>
          <li><a href="./dashboard4.html">
            <i class="fas fa-home"></i>
            <span class="nav-item">Dashboard</span>
          </a></li>
          <li><a href="./registration.html">
            <i class="fas fa-user-plus"></i>
            <span class="nav-item">Register</span>
          </a></li>
          <li><a href="#">
            <i class="fas fa-magnifying-glass"></i>
            <span class="nav-item">Search</span>
          </a></li>
  
          <li><a href="./login/login.html" class="logout">
            <i class="fas fa-sign-out-alt"></i>
            <span class="nav-item">Log out</span>
          </a></li>
        </ul>
      </nav>
  
  
      <section class="main">

        <header class="header">
          <h1></h1>
          <div class="search_box">
            <input type="text" placeholder="Search">
            <i class="fa-sharp fa-solid fa-magnifying-glass"></i>
          </div>
        </header>

        <section class="register">
          <div class="registration-list">
            <h1>Transactions</h1>
            <table class="table">
              <thead>
                <tr>
                  <th>User ID</th>
                    <th>User Name</th>
                    <th>Payment Status</th>
                    <th>Market Name</th>
                    <th>Market Row No</th>
                    <th>Position</th>
                    <th>Neighbor Name</th>
                </tr>
              </thead>
              <tbody>
                <% users.forEach(user => { %>
                  <tr>
                    <td><%= user.id %></td>
                    <td><%= user.name %></td>
                    <td id="paymentStatus<%= user.id %>" class="payment-status"><%= user.payment_status === 'paid' ? 'Paid' : 'Unpaid' %></td>
                    <td><%= user.market_name %></td>
                    <td><%= user.markert_row_no %></td>
                    <td><%= user.position %></td>
                    <td><%= user.neighbor_name %></td>
                  </tr>
                <% }); %>
              </tbody>
            </table>
          </div>
        </section>
        

      </section>
    </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.1.2/socket.io.js"></script>
  <script>
    const socket = io();

    // Log when the socket connection is established
    socket.on("connect", () => {
      console.log("Socket connection established");
    });

    // Listen for payment updates
    socket.on("paymentUpdate", (data) => {
      console.log("Received payment update:", data);
      const paymentStatusElement = document.getElementById(`paymentStatus${data.serialNumber}`);
      if (paymentStatusElement) {
        paymentStatusElement.textContent = data.paymentStatus === 'paid' ? 'Paid' : 'Unpaid';
        paymentStatusElement.classList.add(data.paymentStatus === 'paid' ? 'paid' : 'unpaid');
        console.log("Updated payment status for user:", data.serialNumber);
      } else {
        console.log("Could not find payment status element for user:", data.serialNumber);
      }
    });

    const districtSelect = document.getElementById('district_name');
    const loadingSpinner = document.createElement('div');
    loadingSpinner.className = 'loading-spinner';
    loadingSpinner.textContent = 'Loading districts...';
    districtSelect.parentNode.appendChild(loadingSpinner);

    fetch('/api/districts') // Replace with your actual API endpoint
      .then(response => response.json())
      .then(data => {
        // Clear existing options
        districtSelect.innerHTML = '';

        // Populate dropdown with districts
        data.districts.forEach(district => {
          const option = document.createElement('option');
          option.value = district;
          option.textContent = district;
          districtSelect.appendChild(option);
        });

        // Remove loading spinner
        loadingSpinner.style.display = 'none';
      })
      .catch(error => {
        console.error('Error fetching districts:', error);
        loadingSpinner.textContent = 'Failed to fetch districts';
      });
  </script>
  
  </body>
  </html>
  </span>

  